@model List<BloodDonation.Models.Notification>
@{
    Layout = "~/Views/Shared/_LayoutMedicalCenter.cshtml";
}
<div class="main-content blood-request-list-page">
    <h3 class="fw-bold mb-3">üîî Th√¥ng b√°o d√†nh cho C∆° s·ªü y t·∫ø</h3>
    <hr />
    <div class="notification-list">
        @if (Model != null && Model.Count > 0)
        {
            <table class="table table-bordered table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th>#</th>
                        <th>N·ªôi dung</th>
                        <th>Th·ªùi gian</th>
                        <th>H√†nh ƒë·ªông</th>
                    </tr>
                </thead>
                <tbody>
                @for (int i = 0; i < Model.Count; i++)
                {
                    var n = Model[i];
                    var unreadClass = n.IsRead ? "" : "table-warning unread";
                    <tr class="notification-row @unreadClass" data-id="@n.NotificationID" style="cursor:pointer;">
                        <td>@(i+1)</td>
                        <td>@n.Message @if (!n.IsRead) { <span class="notification-dot"></span> }</td>
                        <td>@n.SentAt.ToString("dd/MM/yyyy HH:mm")</td>
                        <td>
                            <a class="btn btn-sm btn-primary" href="@Url.Action("NotificationDetail", "MedicalCenter", new { notificationId = n.NotificationID })">
                                Chi ti·∫øt
                            </a>
                            <button class="btn btn-danger btn-sm btn-delete-notification" data-id="@n.NotificationID" type="button">X√≥a</button>
                        </td>
                    </tr>
                }
                </tbody>
            </table>
        }
        else
        {
            <div class="alert alert-info">Ch∆∞a c√≥ th√¥ng b√°o n√†o.</div>
        }
    </div>
</div>
@section Scripts {
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(function() {
        $(".notification-row.unread").on("click", function(e) {
            // N·∫øu click v√†o n√∫t Chi ti·∫øt ho·∫∑c X√≥a th√¨ kh√¥ng x·ª≠ l√Ω
            if ($(e.target).closest("a,button").length > 0) return;
            var $row = $(this);
            var id = $row.data("id");
            $.post("/MedicalCenter/MarkAsRead", { id: id }, function(res) {
                if (res.success) {
                    $row.removeClass("unread table-warning");
                    $row.find(".notification-dot").remove();
                    // Decrease badge
                    var $badge = $("#notificationBadge");
                    var count = parseInt($badge.text()) || 0;
                    if (count > 0) $badge.text(count - 1);
                }
            });
        });
        $(".btn-delete-notification").on("click", function(e) {
            e.stopPropagation();
            var $btn = $(this);
            var id = $btn.data("id");
            if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a th√¥ng b√°o n√†y?")) {
                $.post("/MedicalCenter/DeleteNotification", { notificationId: id }, function(res) {
                    if (res.success) {
                        $btn.closest("tr").fadeOut(300, function() { $(this).remove(); });
                    } else {
                        alert(res.message || "X√≥a kh√¥ng th√†nh c√¥ng!");
                    }
                });
            }
        });
    });
</script>
} 